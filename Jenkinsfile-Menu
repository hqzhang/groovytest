//////

library("groovytest-shared-lib@master") _


println menu.getFileDefault('solution')
println menu.getFileContent('SolutionDetail')

properties([
    pipelineTriggers([githubPush()]),
    parameters([
           /*extendedChoice(
              name: 'SolutionDetail',
              description: '',
              visibleItemCount: 50,
              multiSelectDelimiter: ',',
              type: 'PT_SINGLE_SELECT',
              groovyScript: menu.getFileList(), ),*/
           
            [$class: 'ChoiceParameter', choiceType: 'PT_SINGLE_SELECT', filterLength: 1, 
              filterable: false, name: 'SolutionDetail', randomName: 'choice-parameter-242872671984832',
               script: [$class: 'GroovyScript', fallbackScript: [classpath: [], oldScript: '', sandbox: false, script: ''], 
               script: [classpath: [], oldScript: '', sandbox: false, script: menu.getFileDefault('solution') ]]],
            [$class: 'DynamicReferenceParameter', choiceType: 'ET_FORMATTED_HTML', name: 'CONFIG', omitValueField: false, 
            randomName: 'choice-parameter-138673186839723', referencedParameters: 'SolutionDetail', 
            script: [$class: 'GroovyScript', fallbackScript: [classpath: [], oldScript: '', sandbox: false, script: ''], script: [classpath: [], oldScript: '', sandbox: false, 
            script: menu.getContent('SolutionDetail' )]]],

            string(name: 'filebackup', defaultValue: 'backup.xml', description: 'A payload from github webhook'),
             
])
])
def map
def list
pipeline {
    agent any
    stages {
        stage('Create List') {
            steps {
                script {
                    echo "STAGE: create List..."
                    echo "params=$params.CONFIG"
                    echo "parsing yaml"
                    def result = env.CONFIG.replaceAll(/\n/, "\n").replaceAll(',','')
                    println result
                    def myFile = new File('mySuperFile.txt')
                    myFile.write(result)

                    
                    //def str = env.CONFIG.replaceAll(/\n/, "\\n ").replaceAll(',','')
                    //println "str=$str"
                    //def read = readYaml text: str
                    //println read
                    //writeYamlFile(read, "releases/backup.yaml")
                    //sh "cat releases/backup.yaml"
                    /*def targtServer=params.servers
                    echo "params=$params"
                    if ( targtServer.equals('ERROR') ) 
                    {
                        targtServer='s23'
                    }
                    
                    echo "targtServer=$targtServer"
                    workspace=WORKSPACE
                    println "WS=${env.WORKSPACE}"
                    println "WS=${WORKSPACE}"
                    println "pwd="+pwd()
                    println "workspace=$workspace"
                    // you may create your list here, lets say reading from a file after checkout
                    //list = ["Test-1", "Test-2", "Test-3", "Test-4", "Test-5"]
                    list = readXMLList("${workspace}/manifest_Lynx.xml")
                    echo "***************"
                    def jsonText = parseXML("${workspace}/manifest_Lynx.xml")
                    map = readJSON text: jsonText
                    echo "#################"
                     def remote = [:]
                    remote.name = 'test'
                    remote.host = '192.168.2.27'
                    remote.user = 'root'
                    remote.password = 'password'
                    remote.allowAnyHosts = true
    
                    sshCommand remote: remote, command: "ls -lrt"*/
    
                }
            }
        }
   }
}


