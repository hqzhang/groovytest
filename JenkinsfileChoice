#!/usr/bin/env groovy
library("my-shared-library@master") _

// Properties step to set the Active choice parameters via 
println(cons.getTags() )
println(cons.getBranches() )

println "getserver------"
println cons.getServers('Environment')
println "selectserver------"
//println cons.selectServers('Environment')
println "end------"
println cons.getDefaultTag()
println "caall firstend------"
println cons.getEnvironment('DEV')
println "call second-----"
println cons.getEnvironment('DEV')

properties([
    parameters([
        extendedChoice(
            name: 'Environment', defaultValue: 'BAT',
            description: 'file name',
            visibleItemCount: 50, multiSelectDelimiter: ',', type: 'PT_SINGLE_SELECT',
            groovyScript: cons.getEnvironment(), ),

        [$class: 'ChoiceParameter', choiceType: 'PT_SINGLE_SELECT',  
          name: 'Environment', 
          script: [$class: 'GroovyScript', 
          fallbackScript: [classpath: [], sandbox: false, script: 'return ["ERROR"]'], 
                          script: [classpath: [], sandbox: false,
                          script:  cons.getEnvironment('DEV')]]],
        [$class: 'CascadeChoiceParameter', choiceType: 'PT_SINGLE_SELECT',
          name: 'targtServer', referencedParameters: 'Environment', 
          script: [$class: 'GroovyScript', 
                   fallbackScript: [classpath: [], sandbox: false, 
                                     script: 'return ["error"]'], 
          script: [classpath: [], sandbox: false, 
                    script: cons.selectServers('Environment','s22')]]],

        extendedChoice( 
            name: 'TagName', 
            //defaultValue: 'test2', 
            description: 'tag name', 
            type: 'PT_SINGLE_SELECT',
            defaultGroovyScript: cons.getDefaultTag(),
            groovyScript: cons.getTags(), ),
        extendedChoice(
            name: 'myBranch',
            description: 'branch name',
            visibleItemCount: 50,
            multiSelectDelimiter: ',',
            type: 'PT_SINGLE_SELECT',
            groovyScript: cons.getBranches(), ),
        extendedChoice(
            name: 'myFile',
            defaultValue: 'BAT',
            description: 'file name',
            visibleItemCount: 50,
            multiSelectDelimiter: ',',
            type: 'PT_SINGLE_SELECT',
            groovyScript: cons.getEnvironment('DEV'), ),
                 
              
    ])
])
pipeline {
    agent any
stages {
   stage('Build'){
    steps {
       echo 'Building..'
      }
    }
   }
}
